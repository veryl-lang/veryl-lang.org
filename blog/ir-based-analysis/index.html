<!DOCTYPE html>
<html lang="en">

<head prefix="og: http://ogp.me/ns#">
    <meta charset="UTF-8">
    <title>Semantic Analysis based on Intermediate Representation |  </title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    
    <link rel="icon" type="image/png" href="/favicon.ico">
    
    <style>
    :root {
        /* Primary theme color */
        --primary-color: #2baa59;
        /* Primary theme text color */
        --primary-text-color: #543631;
        --primary-text-color-over: #000;
        /* Primary theme link color */
        --primary-link-color: #F9BB2D;
        /* Secondary color: the background body color */
        --secondary-color: #fcfaf6;
        --secondary-text-color: #303030;
        /* Highlight text color of table of content */
        --toc-highlight-text-color: #d46e13;
        --toc-background-color: white;

        --shadow-color: #ddd;

        /* Font used for headers (h1 & h2) */
        --header-font-family: "Fira Sans", sans-serif;
        /* Font used for text */
        --text-font-family: "Fira Sans", sans-serif;
    }

    @media (prefers-color-scheme: dark) {
        :root {
            --primary-color: #293831;
            --primary-text-color: #d7d7d7;
            --primary-text-color-over: #FFF;
            --primary-link-color: #9b9b9b;
            --secondary-color: #282828;
            --secondary-text-color: #f2f2f2;
            --toc-highlight-text-color: #f2f2f2;
            --toc-background-color: #3a3a3a;

            --shadow-color: #202020;
            --header-font-family: "Fira Sans", sans-serif;

            --text-font-family: "Fira Sans", sans-serif;

        }
    }
</style>

    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kumbh+Sans:wght@400;500&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Ubuntu&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="/normalize.css">
    <link rel="stylesheet" href="https://veryl-lang.org/juice.css">
    <!-- Juice references /normalize.css, which doesn't work, so we reference ./normalics.css here -->
    <link rel="shortcut icon" type="image/x-icon" href="/logo.png" />
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-NXW2P6CCF3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
    
      gtag('config', 'G-NXW2P6CCF3');
    </script>
    
<meta property="og:url" content="https://veryl-lang.org/blog/ir-based-analysis/" />
<meta property="og:title" content="Semantic Analysis based on Intermediate Representation" />
<meta property="og:description" content="We plan to introduce a new semantic analyzer based on intermediate representation at the n…" />
<meta property="og:image" content="https://github.com/veryl-lang/veryl/raw/master/support/logo/veryl_ogp.png" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:domain" content="veryl-lang.org" />
<meta name="twitter:title" content="Semantic Analysis based on Intermediate Representation" />
<meta name="twitter:description" content="We plan to introduce a new semantic analyzer based on intermediate representation at the n…" />
<meta name="twitter:image" content="https://github.com/veryl-lang/veryl/raw/master/support/logo/veryl_ogp.png" />

</head>

<body>
    
<header class="box-shadow">
    

<a href="https://veryl-lang.org/">
    <div class="logo">
        <img src="https://veryl-lang.org/logo.png" alt="logo">
        
    </div>
</a>

<nav>
    
    
    
    <a class="nav-item subtitle-text" href="https://veryl-lang.org/install/">Install</a>
    
    
    
    
    <a class="nav-item subtitle-text" href="https://veryl-lang.org/docs/">Docs</a>
    
    
    
    
    <a class="nav-item subtitle-text" href="https://veryl-lang.org/statistics/">Statistics</a>
    
    
    
    
    <a class="nav-item subtitle-text" href="https://veryl-lang.org/blog/">Blog</a>
    
    
        
        <a class="nav-item subtitle-text" href="https://doc.veryl-lang.org/playground">Playground</a>
        
    
    
        
        <a class="nav-item subtitle-text" href="https://github.com/veryl-lang/veryl"><img src="https://veryl-lang.org/github-mark-white.png" alt="icon" height="20"></a>
        
        <a class="nav-item subtitle-text" href="https://discord.gg/MJZr9NufTT"><img src="https://veryl-lang.org/Discord-Symbol-White.png" alt="icon" height="20"></a>
        
    
</nav>

</header>


    <main>
        




<div class="toc">
    <div class="toc-sticky">
        
        <div class="toc-item">
            <a class="subtext" href="https://veryl-lang.org/blog/ir-based-analysis/#important-change">Important change</a>
        </div>
        
        
        <div class="toc-item-child">
            <a class="subtext" href="https://veryl-lang.org/blog/ir-based-analysis/#refering-before-definition"><small>- Refering before definition</small></a>
        </div>
        
        <div class="toc-item-child">
            <a class="subtext" href="https://veryl-lang.org/blog/ir-based-analysis/#multiple-assignment-of-interface-member"><small>- Multiple assignment of interface member</small></a>
        </div>
        
        
        
        <div class="toc-item">
            <a class="subtext" href="https://veryl-lang.org/blog/ir-based-analysis/#release-plan">Release plan</a>
        </div>
        
        
    </div>
</div>



        <div class="content text">
            
<div class="heading-text">Semantic Analysis based on Intermediate Representation</div>
<p>We plan to introduce a new semantic analyzer based on intermediate representation at the next release.
This enables the following features.</p>
<ul>
<li>Bit-wise latch / unassign detection</li>
<li>More detailed type check considering parameter override and generics</li>
<li>Performance improvement</li>
</ul>
<p>For example, the new analyzer can detect the following error.</p>
<pre data-lang="veryl" style="background-color:#393939;color:#dedede;" class="language-veryl "><code class="language-veryl" data-lang="veryl"><span style="color:#fed6af;">var </span><span>a: </span><span style="color:#fffb9d;">logic</span><span>&lt;2&gt;;
</span><span style="color:#fed6af;">always_comb</span><span> {
</span><span>    </span><span style="color:#fed6af;">if </span><span>x {
</span><span>        a = 1;
</span><span>    } </span><span style="color:#fed6af;">else</span><span> {
</span><span>        </span><span style="color:#a0cfa1;">//</span><span style="color:#87ae86;"> a[0] is latch error
</span><span>        a[1] = 1;
</span><span>    }
</span><span>}
</span></code></pre>
<p>About performance improvement, we got the following results.</p>
<ul>
<li>Small testcase (unit tests of Veryl compiler): 448ms to 330ms (+36%)</li>
<li>Large testcase (A real project with 66K lines): 68s to 14s (+386%)</li>
</ul>
<p>Additionally, the introduced intermediate representation can be used for native Veryl simulator.
We plan to work on implementing it after releasing the new version.</p>
<h2 id="important-change">Important change</h2>
<p>The new analyzer can handle several errors which can't be detected by the previous version.</p>
<p>Some tools, including Verilator, ignore these error, so existing Veryl files may contain this error.
In that case, you'll need to fix your code, as it will no longer compile after an update to the Veryl compiler.</p>
<p>Here are some common errors we see in Veryl code on GitHub:</p>
<h3 id="refering-before-definition">Refering before definition</h3>
<p>In the following code, <code>a</code> is referred before it's definition.</p>
<pre data-lang="veryl" style="background-color:#393939;color:#dedede;" class="language-veryl "><code class="language-veryl" data-lang="veryl"><span style="color:#fed6af;">let </span><span>b: </span><span style="color:#fffb9d;">logic</span><span> = a;
</span><span style="color:#fed6af;">var </span><span>a: </span><span style="color:#fffb9d;">logic</span><span>;
</span></code></pre>
<p>The next version Veryl compiler detects the following error.</p>
<pre style="background-color:#393939;color:#dedede;"><code><span>Error: referring_before_definition ()
</span><span>
</span><span>  × a is referred before it is defined.
</span><span>   ╭─[.../test.veryl:2:20]
</span><span> 1 │ module ModuleA {
</span><span> 2 │     let b: logic = a;
</span><span>   ·                    ┬
</span><span>   ·                    ╰── Error location
</span><span> 3 │     var a: logic;
</span><span>   ╰────
</span><span>  help: move definition before reference point
</span></code></pre>
<h3 id="multiple-assignment-of-interface-member">Multiple assignment of interface member</h3>
<p>In the following code, <code>p</code> is driven by both <code>u0</code> and <code>u1</code>.
Actually <code>u0</code> only drives <code>p.x</code> and <code>u1</code> only drives <code>p.y</code>, so it is not multiple assignment exactly.
However new Veryl compiler treats this case as multiple assignment.
This is because determining multiple assignment depending on the module implementation requires traversing the entire instance hierarchy,
which is expensive and makes the location of the error and the cause of the error far apart, making the error message difficult to interpret.</p>
<p>In this case, you can divide <code>master</code> modport into <code>master_x</code> and <code>master_y</code> to resolve this error.</p>
<pre data-lang="veryl" style="background-color:#393939;color:#dedede;" class="language-veryl "><code class="language-veryl" data-lang="veryl"><span style="color:#fed6af;">interface </span><span>InterfaceA {
</span><span>    </span><span style="color:#fed6af;">var </span><span>x: </span><span style="color:#fffb9d;">logic</span><span>;
</span><span>    </span><span style="color:#fed6af;">var </span><span>y: </span><span style="color:#fffb9d;">logic</span><span>;
</span><span>
</span><span>    </span><span style="color:#fed6af;">modport </span><span>master {
</span><span>        x: </span><span style="color:#fffb9d;">output</span><span>,
</span><span>        y: </span><span style="color:#fffb9d;">output</span><span>,
</span><span>    }
</span><span>}
</span><span>
</span><span style="color:#fed6af;">module </span><span>ModuleA {
</span><span>    </span><span style="color:#fed6af;">inst </span><span>p: InterfaceA;
</span><span>
</span><span>    </span><span style="color:#fed6af;">inst </span><span>u0: ModuleB ( p, );
</span><span>    </span><span style="color:#fed6af;">inst </span><span>u1: ModuleC ( p, );
</span><span>}
</span><span>
</span><span style="color:#fed6af;">module </span><span>ModuleB (
</span><span>    p: </span><span style="color:#fed6af;">modport </span><span>InterfaceA::master,
</span><span>) {
</span><span>    </span><span style="color:#fed6af;">assign </span><span>p.x = 0;
</span><span>}
</span><span>
</span><span style="color:#fed6af;">module </span><span>ModuleC (
</span><span>    p: </span><span style="color:#fed6af;">modport </span><span>InterfaceA::master,
</span><span>) {
</span><span>    </span><span style="color:#fed6af;">assign </span><span>p.y = 0;
</span><span>}
</span></code></pre>
<h2 id="release-plan">Release plan</h2>
<p>We plan to release the next version including the new analyzer at the beginning of Feb. 2026.
If you want to try it before the release, you can use nightly compiler like below after 2026-01-22 02:00 (UTC).</p>
<pre style="background-color:#393939;color:#dedede;"><code><span>$verylup install nightly
</span><span>$veryl +nightly --version
</span><span>veryl 0.17.2-nightly (f63dc84 2026-01-20)
</span></code></pre>
<p>The new analyzer may introduce false positive error because it replaces the whole analyzer by new code.
If you find any unexpected behaviour, please open an <a href="https://github.com/veryl-lang/veryl/issues">issue</a> on GitHub.</p>


        </div>

        
        
    </main>

    
    <footer>
    </footer>
    
</body>
<script>
    const scrollHandler = entries => {
        // Find the first entry which intersecting and ratio > 0.9 to highlight.
        let entry = entries.find(entry => {
            return entry.isIntersecting && entry.intersectionRatio > 0.9;
        });
        if (!entry) return;

        document.querySelectorAll(".toc a").forEach((item) => {
            item.classList.remove("active");
        });

        // let url = new URL(`#${entry.target.id}`);
        let link = document.querySelector(`.toc a[href$="${decodeURIComponent(`#${entry.target.id}`)}"]`)
        if (link) {
            link.classList.add("active");
            link.scrollIntoView({ behavior: "auto", block: "nearest" });
        }
    };
    // Set -100px root margin to improve highlight experience.
    const observer = new IntersectionObserver(scrollHandler, { threshold: 1 });
    let items = document.querySelectorAll('h1,h2,h3,h4,h5,h6');
    items.forEach(item => observer.observe(item));
</script>

</html>
